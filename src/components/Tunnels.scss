// Variables
$primary-bg: #f5f5f5;
$secondary-bg: #fafafa;
$tertiary-bg: #f8f9fa;
$border-color: #ddd;
$text-color: #000;  // Changed from #333 to black for better contrast
$text-secondary: #333;  // Darkened from #666
$text-muted: #222;  // Darkened from #444

$blue-primary: #007bff;
$blue-hover: #0056b3;
$blue-light: #2196f3;
$blue-bg: #e3f2fd;
$blue-dark: #1976d2;

$green: #28a745;
$yellow: #ffc107;
$orange: #ff9800;
$orange-bg: #fff3e0;
$highlight-bg: #fff3cd;
$highlight-hover: #f0e5b8;

$lane-bg: #666;
$tunnel-bg: #444;

$radius-sm: 4px;
$radius-md: 6px;
$radius-lg: 8px;

$shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
$shadow-md: 0 2px 6px rgba(0,0,0,0.15);

// Mixins
@mixin queue-area($bg-color, $border-color) {
  background: $bg-color;
  padding: 10px 15px;
  border-radius: $radius-md;
  border: 2px dashed $border-color;
  font-size: 14px;
}

// Main container
.holland-tunnel {
  background: $secondary-bg;
  min-height: 100vh;
  padding-top: 0;
}

.holland-tunnel-container {
  width: 100%;
  max-width: 850px;  // Reduced from 900px
  margin: 0 auto;
  padding: 20px 60px;  // More horizontal padding to ensure staging space is visible
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  @media (max-width: 768px) {
    padding: 15px 40px;  // Ensure staging space on tablets
  }

  @media (max-width: 500px) {
    padding: 10px 30px;  // Ensure staging space on phones
  }
}

// Tunnel visualization container
.tunnel-visualization-svg {
  // Extend beyond container to allow for queue area and staging space
  width: calc(100% + 200px);  // Container + left (100px) + right (100px)
  overflow: visible;  // Allow SVG to draw outside container
  padding: 0;
  // Use negative margins to extend beyond container
  margin-left: -100px;   // Queue area space
  margin-right: -100px;  // Fade + staging space

  @media (max-width: 768px) {
    width: calc(100% + 130px);  // 70 + 60
    margin-left: -70px;
    margin-right: -60px;
  }

  @media (max-width: 500px) {
    width: calc(100% + 100px);  // 50 + 50
    margin-left: -50px;
    margin-right: -50px;
  }

  // Ensure proper responsive behavior
  > div {
    min-width: 0;  // Prevent flex item from overflowing
  }
}

// Header section
.header {
  background: $secondary-bg;
  padding: 0;  // Remove bottom padding to save space
  text-align: left; // Left-align within container

  h1 {
    margin: 0 0 5px 0;
    color: $text-color;
    font-size: 1.8rem;
  }

  h2 {
    margin: 0;
    color: $text-secondary;
    font-size: 1.2rem;
    font-weight: normal;
  }
}

// Controls bar (moved below visualization)
.controls-bar {
  background: $primary-bg;
  padding: 15px 20px;
  border-radius: $radius-lg;
  display: flex;
  justify-content: center;
}

// Control panel
.control-panel {
  background: $primary-bg;
  padding: 20px;
  border-radius: $radius-lg;
  margin-bottom: 30px;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.controls {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;

  .button-group {
    display: flex;
    gap: 4px;
  }

  button {
    padding: 8px 12px;
    font-size: 16px;
    border: none;
    border-radius: $radius-md;
    background: $blue-primary;
    color: white;
    cursor: pointer;
    transition: background 0.2s, opacity 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;

    &:hover:not(:disabled) {
      background: $blue-hover;
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }

  label {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  input[type="range"] {
    width: 100px;
  }
}

.header-left {
  flex: 1;
}

// Clock styles
.clock-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;

  &-large {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;

    .analog-clock {
      width: 120px;
      height: 120px;
      filter: drop-shadow($shadow-md);
    }
  }
}

.analog-clock {
  filter: drop-shadow($shadow-sm);
}

.digital-time {
  font-size: 1.2em;
  font-weight: bold;
  color: $text-color;
  font-variant-numeric: tabular-nums;

  &-large {
    font-size: 1.8em;
    font-weight: bold;
    color: $text-color;
    font-variant-numeric: tabular-nums;
  }
}

.hint {
  font-size: 12px;
  color: $text-secondary;
  margin-left: 15px;
}

// Tunnel visualization
.tunnel-visualization {
  display: flex;
  flex-direction: column;
  gap: 40px;

  &-svg {
    background: $secondary-bg;
    padding: 0;
    border-radius: $radius-lg;
    overflow-x: auto;

    svg {
      display: block;
    }
  }
}

.direction-container {
  background: $secondary-bg;
  padding: 20px;
  border-radius: $radius-lg;
  border: 2px solid $border-color;

  h2 {
    margin: 0 0 10px 0;
    color: $text-muted;
  }
}

.phase-indicator {
  font-weight: bold;
  color: $text-secondary;
  margin-bottom: 15px;
  text-transform: capitalize;
}

// Tunnel and lane styles
.tunnel {
  display: flex;
  flex-direction: column;
  gap: 5px;
  background: $tunnel-bg;
  padding: 10px;
  border-radius: $radius-lg;
  position: relative;
  min-height: 140px;
  z-index: 1;
}

.lane {
  height: 60px;
  background: $lane-bg;
  border-radius: $radius-sm;
  position: relative;
  transition: background-color 0.3s;
  display: flex;
  align-items: center;
  padding: 0 10px;
  overflow: visible;

  &-marker {
    background: rgba(255, 255, 255, 0.2);
    padding: 4px 8px;
    border-radius: $radius-sm;
    font-size: 12px;
    color: white;
    z-index: 5;
    position: relative;
  }

  // Lane states based on phase
  &[data-phase="normal"] {
    background: $lane-bg;
  }

  &[data-phase="bikes-enter"],
  &[data-phase="clearing"],
  &[data-phase="sweep"] {
    &.lane-2 {
      background: $green;
    }
  }

  &[data-phase="pace-car"] {
    &.lane-2 {
      background: $yellow;
    }
  }
}

.eastbound {
  direction: ltr;
}

.westbound {
  direction: rtl;
}

// Queue areas
.queue-area {
  margin-top: 15px;
  display: flex;
  gap: 20px;
  flex-wrap: wrap;

  &-west {
    justify-content: flex-end;
  }

  &-east {
    justify-content: flex-start;
  }
}

// Bike queue and pen
.bike-queue {
  @include queue-area($blue-bg, $blue-light);
  display: flex;
  align-items: center;
  gap: 10px;
}

.queue-label {
  font-weight: bold;
  color: $blue-dark;
}

.queue-bikes {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

.queued-bike {
  font-size: 20px;
  display: inline-block;
  animation: bike-bounce 2s ease-in-out infinite;

  &:nth-child(odd) {
    animation-delay: 0.5s;
  }
}

@keyframes bike-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-3px); }
}

// Car queue
.car-queue {
  @include queue-area($orange-bg, $orange);
  display: flex;
  align-items: center;
  gap: 10px;

  &-line {
    @include queue-area($orange-bg, $orange);
  }
}

.queue-cars {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;

  &-line {
    display: flex;
    gap: 2px;
    margin-top: 5px;
    align-items: center;
  }
}

.queued-car {
  font-size: 20px;
  display: inline-block;

  &-line {
    font-size: 20px;
    display: inline-block;
  }
}

// Bike pen
.bike-pen {
  background: $blue-bg;
  padding: 15px;
  border-radius: $radius-md;
  border: 2px dashed $blue-light;
  min-height: 80px;
  position: relative;
  width: 200px;
}

.pen-bikes {
  position: relative;
  height: 60px;
}

.penned-bike {
  position: absolute;
  font-size: 20px;
  animation: bike-bounce 2s ease-in-out infinite;
}

// Timeline and How section (side by side)
.timeline-and-how {
  display: flex;
  gap: 0;  // No gap between sections
  // Content stays within body container

  @media (max-width: 768px) {
    flex-direction: column;
    gap: 0;
  }
}

.timeline-section {
  flex: 0 0 auto;  // Size to content, don't grow
  background: $tertiary-bg;
  padding: 10px 10px;  // Minimal padding to stay within container
  border-radius: $radius-lg;

  h2 {
    margin: 0 0 15px 0;
    color: $text-color;
    font-size: 1.5rem;
  }

  h3 {
    margin: 0 0 15px 0;
    color: $text-color;
  }

  ul {
    margin: 0;
    padding-left: 20px;
    line-height: 1.5;  // Match How/Why sections
  }

  li {
    margin: 4px 0;  // Match How/Why sections
    color: $text-secondary;

    &.current-phase {
      color: $text-color;
      background: rgba(76, 175, 80, 0.1);
      border-left: 3px solid #4caf50;
      padding-left: 5px;
    }

    &.timeline-item {
      cursor: pointer;
      transition: background-color 0.2s ease, border-color 0.2s ease;
      padding: 2px 8px;  // Reduced from 4px to 2px
      margin-left: -8px;
      border-radius: $radius-sm;
      border-left: 3px solid transparent;

      &:hover {
        background: $highlight-bg;
      }

      &.current-phase:hover {
        background: $highlight-hover;
        color: $text-color;
      }
    }
  }
}

.how-section {
  flex: 1;  // Takes remaining space
  background: $tertiary-bg;
  padding: 10px 15px 15px 15px;  // Reduced padding
  border-radius: $radius-lg;

  h2 {
    margin: 0 0 15px 0;
    color: $text-color;
    font-size: 1.5rem;
  }

  ul {
    margin: 0;
    padding-left: 25px;
    color: $text-secondary;
    line-height: 1.5;  // Reduced from 1.8

    li {
      margin: 4px 0;  // Reduced from 8px
    }

    ul {
      margin-top: 4px;  // Reduced from 8px
      padding-left: 20px;
    }
  }
}

// Why section (full width below)
.why-section-container {
  // Content stays within body container, no special sizing needed
}

.why-section {
  background: $tertiary-bg;
  padding: 10px 15px 15px 15px;  // Reduced padding
  border-radius: $radius-lg;

  h2 {
    margin: 0 0 20px 0;
    color: $text-color;
    font-size: 1.5rem;
  }

  ol {
    margin: 0;
    padding-left: 25px;
    color: $text-secondary;
    line-height: 1.5;  // Reduced from 1.8

    li {
      margin: 4px 0;  // Reduced from 8px
    }
  }
}

// Vehicle styles
.vehicle {
  position: absolute;
  z-index: 20;
  line-height: 1;
  user-select: none;
  pointer-events: none;
  transition: left 0.05s linear;

  &-car {
    filter: hue-rotate(0deg);
  }

  &-bike {
    filter: hue-rotate(90deg);
  }

  &-sweep {
    filter: brightness(1.2);
  }

  &-pace {
    filter: hue-rotate(240deg);
  }
}

// Tooltip styles
.react-tooltip {
  z-index: 9999 !important;
}

// (Old info-sections removed - replaced by timeline-and-how and why-section)

// Appendix sections
.appendix-container {
  // Content stays within body container, no special sizing needed

  &.first {
    // No special margin needed
  }

  &.middle {
    // No special margin needed
  }

  &.last {
    margin-bottom: 20px;
  }
}

.appendix-section {
  background: $tertiary-bg;
  border-radius: $radius-lg;
  padding: 10px 15px 15px 15px;  // Reduced padding

  h2 {
    margin: 0 0 15px 0;
    color: $text-color;
    font-size: 1.5rem;
  }

  p {
    margin: 0 0 10px 0;
    line-height: 1.5;

    &:last-child {
      margin-bottom: 0;
    }
  }

  // Video layout
  &.with-video {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
    align-items: flex-start;

    @media (max-width: 768px) {
      gap: 15px;
    }

    .text-content {
      flex: 1 1 300px;
      min-width: 250px;
    }

    .video-content {
      flex: 0 0 auto;
      display: flex;
      justify-content: center;
    }
  }
}

// Footer
.footer {
  margin-top: 20px;
  padding: 30px 20px 60px;
  background: $primary-bg;
  border-top: 1px solid $border-color;
}

.socials {
  text-align: center;

  .icon {
    display: inline-block;
    margin: 0 1rem;
    color: $text-color;
    transition: opacity 0.2s;
    vertical-align: middle;
    width: 3rem;
    height: 3rem;

    &:hover {
      opacity: 0.7;
    }

    svg {
      display: block;
      width: 3rem;
      height: 3rem;
    }
  }

  .footer-text {
    margin-top: 16px;
    font-size: 14px;
    color: $text-secondary;
    line-height: 1.8;

    a {
      color: $text-color;
      text-decoration: none;
      font-weight: 500;

      &:hover {
        text-decoration: underline;
      }
    }
  }
}

// Media queries
@media (max-width: 768px) {
  .controls {
    // Keep controls in a row on mobile
    flex-direction: row;
    align-items: center;
    gap: 10px; // Reduce gap on mobile

    // Smaller buttons on mobile
    button {
      padding: 6px 8px;
      font-size: 14px;

      svg {
        width: 16px;
        height: 16px;
      }
    }

    // Speed control styling
    label {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      font-size: 12px;
      flex: 1; // Take available space
      min-width: 0; // Allow shrinking
    }

    input[type="range"] {
      width: 100%; // Use full width of label
      min-width: 60px; // But not too small
    }
  }

  // Remove horizontal padding on narrow screens for tunnel visualization
  .tunnel-visualization-svg {
    padding: 0;
    overflow-x: visible;
  }

  // Ensure holland-tunnel takes full width
  .holland-tunnel {
    width: 100%;
    overflow-x: hidden;
  }

}